/*
 * $Id: Imakefile,v 1.9 1993-10-09 19:00:42 probe Exp $
 *
 * (c) 1993 Massachusetts Institute of Technology.
 */

#define ISUBDIRS snmplib

PSLIBDIR=/usr/athena/lib/ps
PSTEMPDIR=/tmp
DITDIR=/usr/lib/font
TROFFFONTDIR=$(PSLIBDIR)/troff.font

#if defined(AIX) && defined(_I386)
OCFLAGS=-D_BSD
OLIBS=-lbsd
#endif
#if defined(_IBMR2)
OLIBS=-lbsd
#endif
#if defined(_AUX_SOURCE)
OLIBS=-lposix
#endif

DEFINES=-DBSD -DSYSLOG -DZEPHYR ${OCFLAGS}
LIBS= -lzephyr -lcom_err -lkrb -ldes $(OLIBS)

create_dir($(PSLIBDIR))
install_script(psif,,$(PSLIBDIR)/psif)

SimpleProgram(psbanner,psbanner.o psutil.o config.o,,$(PSLIBDIR))
SimpleProgram(pscomm,pscomm.o psutil.o config.o,$(LIBS),$(PSLIBDIR))

SimpleProgram(lps40comm,lps40comm.o psutil.o config.o,$(LIBS),$(PSLIBDIR))

SimpleProgram(hpcomm,hpcomm.o psutil.o config.o hpquery.o snmplib/libsnmp.a,$(LIBS),$(PSLIBDIR))
SimpleProgram(duplex2,duplex2.o,,$(PSLIBDIR))

SpecialObject(hpcomm.o,hpcomm.c,-DBRIDGE -DHP)
SpecialObject(hpquery.o,hpquery.c,-I./snmplib)

hpcomm.c: pscomm.c
	$(RM) hpcomm.c; ln -s pscomm.c hpcomm.c

#if 0
SimpleProgram(hpbanner,hpbanner.o psutil.o config.o,,$(PSLIBDIR))
SimpleProgram(lps40banner,lps40banner.o psutil.o config.o,,$(PSLIBDIR))
SpecialObject(hpbanner.o,hpbanner.c,-DBPRO_ENV=\"HPBANNERPRO\")
SpecialObject(lps40banner.o,lps40banner.c,-DBPRO_ENV=\"LPS40BANNERPRO\")

hpbanner.c: psbanner.c
	$(RM) hpbanner.c; ln -s psbanner.c hpbanner.c
lps40banner.c: psbanner.c
	$(RM) lps40banner.c; ln -s psbanner.c lps40banner.c
#endif

config.c: config.proto Makefile
	$(RM) config.c
	sed	-e s,PSLIBDIR,$(PSLIBDIR),g \
		-e s,TROFFFONTDIR,$(TROFFFONTDIR),g \
		-e s,DITDIR,$(DITDIR),g \
		-e s,PSTEMPDIR,$(PSTEMPDIR),g \
		config.proto >config.c

snmplib/libsnmp.a:: snmplib
config.o: config.c
pscomm.o: psspool.h
pscomm.o psutil.o: transcript.h
pscat.o pscatmap.o: action.h 

clean::
	$(RM) config.c hpcomm.c hpbanner.c lps40banner.c
