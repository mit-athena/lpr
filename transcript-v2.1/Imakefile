/*
 * $Id: Imakefile,v 1.10 1993-10-14 12:47:23 probe Exp $
 *
 * (c) 1993 Massachusetts Institute of Technology.
 */

#define ISUBDIRS snmplib

PSLIBDIR=/usr/athena/lib/ps
PSTEMPDIR=/tmp
DITDIR=/usr/lib/font
TROFFFONTDIR=$(PSLIBDIR)/troff.font

#if defined(AIX) && defined(_I386)
OCFLAGS=-D_BSD
OLIBS=-lbsd
#endif
#if defined(_IBMR2)
OLIBS=-lbsd
#endif
#if defined(_AUX_SOURCE)
OLIBS=-lposix
#endif

DEFINES=-DBSD -DSYSLOG -DZEPHYR ${OCFLAGS}
LIBS= -lzephyr -lcom_err -lkrb -ldes $(OLIBS)

create_dir($(PSLIBDIR))

SimpleProgram(psbanner,psbanner.o psutil.o config.o,,$(PSLIBDIR))
SimpleProgram(pscomm,pscomm.o psutil.o config.o,$(LIBS),$(PSLIBDIR))
SimpleProgram(pstext,pstext.o psutil.o config.o,,$(PSLIBDIR))
SimpleProgram(psrv,psrv.o psutil.o config.o,,$(PSLIBDIR))
SimpleProgram(duplex2,duplex2.o,,$(PSLIBDIR))

/* Printer-specific filters */
SimpleProgram(lps40comm,lps40comm.o psutil.o config.o,$(LIBS),$(PSLIBDIR))
SimpleProgram(hpcomm,hpcomm.o psutil.o config.o hpquery.o snmplib/libsnmp.a,$(LIBS),$(PSLIBDIR))

all install:: psif

install_script(psif,,$(PSLIBDIR))
install_script(psbad.sh,,$(PSLIBDIR)/psbad)
install::
	-for i in psof psgf psnf pstf psrf psvf pscf psdf; do \
		$(RM) $(DESTDIR)$(PSLIBDIR)/$$i; \
		ln -s psif $(DESTDIR)$(PSLIBDIR)/$$i; \
		done
	-for i in pstext.pro banner.pro lps40banner.pro; do \
		$(RM) $(DESTDIR)$(PSLIBDIR)/$$i; \
		$(INSTALL) -c -m 0444 $$i $(DESTDIR)$(PSLIBDIR)/$$i; \
		done

SpecialObject(hpcomm.o,hpcomm.c,-DBRIDGE -DHP)
SpecialObject(hpquery.o,hpquery.c,-I./snmplib)

hpcomm.c: pscomm.c
	$(RM) hpcomm.c; ln -s pscomm.c hpcomm.c

config.c: config.proto Makefile
	$(RM) config.c
	sed	-e s,PSLIBDIR,$(PSLIBDIR),g \
		-e s,TROFFFONTDIR,$(TROFFFONTDIR),g \
		-e s,DITDIR,$(DITDIR),g \
		-e s,PSTEMPDIR,$(PSTEMPDIR),g \
		config.proto > config.c

psif: psif.proto Makefile
	$(RM) psif
	sed	-e s,XPSLIBDIRX,$(PSLIBDIR),g \
		psif.proto > psif

snmplib/libsnmp.a:: snmplib
config.o: config.c
pscomm.o: psspool.h
pscomm.o psutil.o: transcript.h
pscat.o pscatmap.o: action.h 

clean::
	$(RM) config.c hpcomm.c hpbanner.c lps40banner.c psif
